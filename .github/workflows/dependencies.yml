name: Update Dependencies

on:
  schedule:
    # 每周一凌晨2点运行
    - cron: '0 2 * * 1'
  workflow_dispatch:
    # 允许手动触发

jobs:
  update-deps:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.12
    
    - name: Install pip-tools
      run: |
        python -m pip install --upgrade pip
        pip install pip-tools
    
    - name: Update requirements
      run: |
        # 更新 requirements.txt
        pip-compile --upgrade requirements.txt --output-file requirements.txt
        
        # 更新开发依赖
        pip-compile --upgrade pyproject.toml --extra dev --output-file requirements-dev.txt
    
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: 'chore: update dependencies'
        title: 'chore: update dependencies'
        body: |
          ## 依赖更新
          
          自动更新项目依赖到最新版本。
          
          ### 更新内容
          - 更新 requirements.txt
          - 更新开发依赖
          
          ### 检查清单
          - [ ] 测试通过
          - [ ] 代码质量检查通过
          - [ ] 安全扫描通过
          
          ---
          
          *此 PR 由 GitHub Actions 自动创建*
        branch: update-dependencies
        delete-branch: true 